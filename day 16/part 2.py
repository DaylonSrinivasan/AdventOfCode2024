input = """#############################################################################################################################################
#...........#.......#.........#.........#.........#.............#...........#...#.......#.....#.......#.......#.......#.....#.........#....E#
#.#########.#####.#.#######.#.###.#.###.#.#####.###.#.#########.#.#.#######.#.#.#####.#.###.#.#.#####.#.#.###.#####.#.#.###.#.#######.#.###.#
#.............#...#.........#...#.#.#.....#...#.#...#.#.......#...#.#.....#...#.......#...#.........#.#.#...#.......#...#...#...#...#.#...#.#
#########.###.#.###.#######.###.#.#.#.#####.#.#.#.###.#.#########.#.#.###.###########.###.#.#######.#.#####.###########.#.###.#.#.#.#.#.#.#.#
#.......#.#...#...#.#...#.....#.#.#.#.#...#.#...#...#.#.........#.#.#.....................#.....#...#...................#...#.#.#.#.#.#.#.#.#
#.#####.#.#.###.#.###.#.#.#.###.###.###.#.#########.#.#.#####.#.#.#.#.#.###.###.#.#.#.#.#.#.###.#.#.#####.#.#.#####.#.#.###.#.#.###.#.#.#.#.#
#...#.....#.#.#.#.....#.#.#...#...#.....#...........#.#.#...#.#.#.#.#.#...#...#.#.#.#.#...#...#.#.#...#...#.#.#...#...#.#.#.#.#...#...#.#.#.#
#.#.#######.#.#.###.#.#.###.#.###.#.#####.###########.#.###.#.###.#.#.#.#####.#.#.#.#.#########.#.#####.###.#.###.#####.#.#.#.###.#.###.#.#.#
#.#...#...#.#...#...#.#.............#...#...#.......#.#.....#...#...#...#.....#.#...#.......#...#...#...#...#.....#.........................#
#.###.#.###.#####.#.#.#.#.#.#.#.#####.#.#####.#####.#.#####.###.#.#####.#.###.#.#####.###.#.#.#####.#.###.###.###.#.###.#.###.#.#####.#####.#
#...#.#.#...#.....#.....#.#...#.#.....#.......#...#.#...#...#.#...#.............#.........#...#.....#.#...........#.#.....#...#.#.#...#...#.#
#####.#.#.###.#######.###.#.###.#.#############.###.###.#.###.#.#.#####.#.###.#.#.###.#########.#.#.#.#.#####.#####.#.#########.#.#.###.#.###
#.....#.#.#...#...........#...#...#...........#.....#...#.....#.#.....#.#...#.#.#.#...#.....#.#.#.....................#.........#.#.#...#...#
#.#####.#.#.#.###.###.#.###########.#######.###.#####.#######.#.#####.#####.###.###.#.###.#.#.#.#.###.#.#####.#######.###.#######.#.#.#####.#
#...#...#.#.#...#.#...#.#.........#.#.#...#.#...#.....#.....#.#.#...#.....#...#.....#.....#.#...#...#.#...#.......#...#...#...#.....#.#...#.#
#.#.###.#.#.###.#.#.#.#.#.#####.###.#.#.#.#.#.#######.#.#####.#.#.#####.#.###.#######.#####.#.#####.#.#.#.#.#####.#.###.###.#.#######.###.#.#
#.#.#...#.#.#...#.#.#...#.....#.......#.#...#.....#...#.......#.#.#.............#.#...#...#.#.#.....#.#.#.#.....#.#...#.....#.#...........#.#
#.#.#.###.#.#.#####.#####.#####.#####.#.###.#####.#.###########.#.#.###########.#.#.#.#.###.#.#.###.#.###.#.###.#.###.#######.#.###########.#
#.#.#.#...#.#...#...#.....#...#.#...#.#.#.#.#...#...#...........#.#.#.#...#...#.#...#.#.#...#.#...#.#...#.#...#.#...#.#.......#.....#.......#
###.#.#.###.###.#.###.#####.#.###.#.###.#.#.#.#.#####.#.#########.#.#.#.#.#.#.#.#.###.#.#.#######.#.###.#.###.#.###.#.#.#.#########.#.#####.#
#...#...#...#...#.....#...#.#.....#.....#...#.#.#.....#.#...#.....#...#.#...#.#.#...#.#.....#...#.#...#.#...#.#...#.#.#.#.#.........#.....#.#
#.#####.###.#.#########.#.#.#############.#####.#.#####.#.#.#####.###.#.#####.#.###.#.#####.#.#.#.###.#.###.#.###.###.#.#.#.#############.#.#
#.....#.......#.........#.#.#.....#.....#.#...#.......#...#...#...#...#...#...#...#.#.....#...#...#...#...#.#...#.....#.#.#.......#.....#...#
#####.#####.###.#########.#.#.###.#.#####.#.#.#.#############.#.###.#####.#.#####.#.#####.#######.#.#####.#.###.#######.#########.###.###.#.#
#.....#.#...............#.#.#.#...#...#...#...#.#.........#...#.......#...#.#.#...#.#...#.#.......#.#...#...#.#...#...........#.#.....#...#.#
#.#####.#.#.###.#.#####.#.#.#.#.###.#.#.###.#.###.#######.#.#########.#.###.#.#.###.#.#.#.#.#####.#.#.#.#####.###.#.#####.###.#.#####.#.#####
#...#.....#...#.#.#...#.#.#.#.#.#...#.#.#...#...#.....#.#...#.......#.#.#...#.#...#.#.#...#.....#.#.#.#.......#.......#...#.........#.#.....#
###.#####.#.#.#.#.#.###.#.#.#.#.#####.#.#.#.###.###.#.#.###.#.#####.###.#.###.###.#.#.#########.#.###.#######.#.#######.#############.#####.#
#...#...#...#.#.#.#...#.#...#.#.#.....#.#.....#...#.#.#.....#.#...#.#...#.......#.#.#.........#.#.#...#.....#.........#.....#...............#
#.###.#.###.#.#.#.#.#.#.#.###.#.#.#####.#.###.###.#.#.###.###.#.###.#.#####.#.###.###.#.###.###.#.#.#######.#.#######.#.###.#.###########.#.#
#.#...#.#...#.#.#.#...#...#...#.#.#...#.#...#.#.#.#.#...#.#.#.#...#.#.....#.#.#.......#...#.#...#...#.....#.#.....#...#...#.#.#.....#.....#.#
#.#.###.#.#.#.#.#.#.#######.###.#.#.#.#.#####.#.#.#####.#.#.#.###.#.###.#.#.#.#.#########.#.#.###.#####.#.#.###.###.#####.#.#.#.#.###.#####.#
#.#.#...#.....#.#...#.......#.#.#...#.#.....#.#...#...#.#...#.....#.#...#.#.#.#.#.........#.#...........#.#...#.....#...#.#.#.#.#.#...#.....#
#.#.#.###.#.###.###.#.#######.#.#####.#####.#.#.###.#.#.#######.#.#.#.#.#.#.#.#.#.#########.#.###########.###.#######.#.#.#.#.###.#.###.#####
#.#.#.#.......#.#...#.#.......#.....#.....#...#.#...#...#.......#...#.#...#.#.#.#.........#.......#.....#.............#...#.......#...#.....#
#.#.#.#.###.###.#.###.###.#########.###.#######.###.###.#.#######.#.#.#####.#.#.#####.#####.#.#####.###.###.#.###################.###.#####.#
#.#.#.#.#.#.....#...#...#.........#...#.........#...#.....#.....#.#.#.....#.#.......#.#.....#.#.....#...#.#.#.....#...#...#.....#.#...#...#.#
#.#.#.#.#.#.###.#######.#.###.###.###.#.#########.###.#####.###.#.#######.#.#########.#.###.###.#####.#.#.#.#####.#.#.#.#.#.###.#.#.###.#.#.#
#...#.#...#.#...#.....#.#.#...#.#.#.#.#.....#.....#...#...#.#.#.#.......#.#.......#...#...#.#...#...#.#.....#...#.#.#...#.#.#.....#...#.#...#
#.###.#.###.#####.###.#.###.###.#.#.#.#####.#.###.#.###.#.#.#.#.###.#####.#######.#.#####.#.#.#####.#.###.#.#.###.#######.#.#####.###.#.#####
#.#...#.....#.....#.#...#.......#...#.....#.#.#...#.....#...#.............#...#...#.#...#.#...#.....#...#.#.#.....#.......#...#...#...#.....#
###.#####.#.#.#####.#####.###.#.###.#####.#.###.#.#####.#.#######.###.#####.#.#.###.#.###.#.#.#.###.###.###.#####.#.#####.###.#.#.#.#.#####.#
#...#...............#.....#...#.#.....#...#.....#.#.....#.....#...#...#.#...#.#.......#.....#.#.#.#.#.#.#...#...#...#.....#...#.....#...#...#
#.#####.#####.#.#.#.#.#.#####.###.#####.#######.###.#########.###.#.###.#.#.#.#.#######.###.#.#.#.#.#.#.#.###.#.#######.###.###.#.###.###.###
#.....#.......#.#.#.#...#...#.#...#.....#.......#...#.......#...#.#.#.....#.#.....#.....#.#.#.#.#.#.....#.....#.......#...#.#...#...#...#...#
#.###.###.#######.#.#.###.#.#.#.###.#############.#########.###.###.#####.#.#######.#####.#.#.#.#.###.#.###.#########.#.###.#.#.#.#.#.#.###.#
#...#...#.#.....#.#.#.....#.....#...#.......#.....#...........#.....#...#.#...#.....#...#...#.#.#...#.#.....#.......#.#.#...#...#.#...#...#.#
#.#####.#.###.#.#.#.#######.#####.###.#####.#.#####.#####.###.#####.#.#.#####.#.###.#.#.#####.#.#.###.#######.#####.#.#.#.###.#.#.###.###.#.#
#.............#...#...#.....#.....#...#.....#.#.......#.#.....#.#.....#.....#.#.#...#.#...#.....#...#.......#...#.#.#.#.#.#.#.#.#.#.....#.#.#
###.#####.###########.#.###.#.#####.#.#.#####.#######.#.#####.#.#.#.#######.#.#.#####.###.#.#######.###.#####.#.#.#.#.###.#.#.#.#.#.#.###.#.#
#...#...#.#...#.....#...#.#.#.....#.#.#.....#.........#.......#...#.#.........#.........#...#...........#...#.#.#.#.#.....#...#.....#.....#.#
#.###.#.###.#.#.###.#####.#.###.#.#.#.#####.#.#.#########.#######.#.#.#######.###########.###.###.#.#####.#.###.#.#.###.###.#.#.#.###.###.#.#
#.#...#.#...#...#...#.#...#...#.#...#.....#.......#.....#.......#.#.#.........#.....#...#...#.#...#.#...#.#.....#...#...#...#.............#.#
#.#.###.#.#######.###.#.#.###.#.#.###.#.#######.#.#.###.#######.#.#.#####.#####.###.#.#.#.###.#.###.#.#.#.#########.#####.#.###.#.#.###.#.#.#
#.#...#...#.......#.#...#.........#.#.#.....#...#...#.#...#...#.#.#...#.#.#...#.#.#...#.#.#...#...#.#.#.#.........#.......#.#...#.#.#...#.#.#
#.###.#####.#####.#.#.#########.#.#.#.#####.#.#######.###.#.#.#.#.###.#.#.#.#.#.#.#####.###.#####.#.#.#.#########.#########.#.#.#.#.#.#####.#
#.#...#...#...#.....#...#.......#.#...#...#...#.....#...#.#.#.#.#...#.#...#.#...............#...#.#...#.#.#.....#.#.......#...#...#.#.......#
#.#.#####.###.#.#.#.###.#.#######.#.###.#.#######.#.#.#.#.###.#.###.#.#.###.#########.#######.#.#.#####.#.#.###.#.#.###.#######.#.#.###.#####
#.#.........#...#.#...#...#.#.....#...#.#.........#...#.#...#.........#.#...#.......#...#.....#.#.....#...#.#.....#...#.#...#.....#...#.#...#
#.#.#######.###.###.#.#####.#.#######.#.###############.###.#####.#######.#####.###.#.#.#.#####.#####.#####.#.#######.###.#.#.#.#####.#.#.#.#
#.#.......#...#.....#.........#.#.......#...#.....#.....#.#.....#.#.....#...#...#.....#.#.#...#.#...#.#.....#.......#.#...#...#.....#.#.#.#.#
#.#.#####.#.#######.#.#.#####.#.#.#######.#.#.#.###.#####.#####.#.#.###.###.#.#######.#.#.###.#.###.#.#.###.#####.#.#.#.#######.###.#.#.#.#.#
#.#.....#...#.......#.#.#.....#.#.#.#.....#...#.....#.........#.#.#...#.#...#.....#...#...#...#.....#.#...#.#.....#.#...#.....#...#...#.#.#.#
#.#.###.#####.#######.###.#####.#.#.#.#.#.#.#.#####.###.#.###.#.#.###.#.#.#######.#.#######.###.#####.#.#.###.#####.#.###.#.#.#.#.#####.#.#.#
#.....#...#.........#.....#...#.....#...#...#...#.....#.#.#...#.#.#...#.#.#.......#...#.........#.....#.#.....#...#.#...#.#...............#.#
###.#####.#.#####.#.#####.#.#.#######.#.###.###.###.#.#.#.#.#.#.###.###.#.#.#########.#.#####.#.#.#####.#########.#.###.#.###.#.#.###.###.###
#...#.............#.#...#...#.....#...#.#.#...#.....#...#...#.#...#.#.#.#.....#.....#.......#...#.#...#.#...#...#.#...#.#.#...#.#...#...#...#
#.#.#.#.###########.#.#.#########.#.#.#.#.###.#########.#.#.#.###.#.#.#.#.###.#.###.#####.#######.#.#.#.#.#.#.#.#.###.#.#.#.###.###.###.###.#
#.#.#...#.#.......#...#...#...#...#.#.#.#...#...#.........#.....#.#...#.....#.....#.#...#.#.......#.....#.#...#...#...#.#.........#.....#...#
#.#.###.#.#.#####.#######.#.###.###.#.#.###.###.#########.#######.###.#####.#######.#.#.###.#######.#####.#######.#.###.###.###.#####.###.#.#
#.....#...#...#...........#...#...#.#...#.....#.#.....#...#...#...#...#...#...#.....#.#.....#...#...#.#.....#.....#.#.#...#.#.......#...#.#.#
###.#.#.#.###.#############.#.###.#.#####.###.#.#.###.###.#.#.#.###.#####.###.#.###.#.#########.#.###.#.###.#.#####.#.###.###.#####.###.#.#.#
#.....#...#.#.......#.....#.#...#...#.....#...#...#...#...#.#.#.#...#.#...#.....#...#.....#.....#.#.#...#.#.#...#.#.#...#.....#...#.#.#...#.#
#.#.#.#.###.#######.#.###.#.###.#####.#####.#######.###.#.#.#.#.#.###.#.#############.###.#.#####.#.#.###.#.###.#.#.#.#########.###.#.#####.#
#.#...#.....#.......#.#.#...#.#.......#...#.....#...#...#...#...#...#.#.........................#.#...#...#.#...#.#.#.....#.........#.....#.#
#.#.#.#.###.#.#######.#.#####.###.#####.###.#.#.#.###.#########.###.#.#####################.###.#.#.#.#.###.#.###.#.#.#.###.#########.#.###.#
#...#...#...#.....#...#.........#...#.........#.#.#...........#.#...#.....#.......#.......#...#...#.....#...#.....#.#.#...#.#...#.#...#.....#
#.#.#.#.#.#######.#.###.###.###.###.###########.#.###.#.###.#.#.#.###.###.#####.#.#.#####.#.#####.#####.#.###.#####.#####.#.#.#.#.#.#########
#.............#...#.#.....#...#.#.#.......#.....#.....#.........#...#.#.........#...#...#.#.#...#.........#...#...#.....#.....#.#...#.......#
###.#.#######.#.###.#.#######.#.#.#######.#############.###########.#.#####.#########.#.#.###.#.###########.###.#.###.#.#.#####.#.#.#######.#
#.#.....#...#.#...#.#...#.....#.......#.#.#...................#...........#.#.....#...#.#.....#...#...#.......#.#...#.#.....#.#...#.....#...#
#.###.#.#.#.#.###.#.#####.###########.#.#.#.#.#.###############.#.###.###.###.###.#.#####.#######.#.#.#.###.###.###.#######.#.###.#####.#.#.#
#.....#.#.#.....#.#.......#.............#.#...#.#...#.....#.....#...#.........#...#...#.........#...#.#.#...#...#...#.......#...#.....#.#.#.#
###.#.#.#.#######.#.#.###.#.#.###########.#.#.#.#.#.#.###.#.#####.#.###.#######.###.#.#.#.#####.#####.###.#.#.###.###.#######.###.###.#.#.#.#
#...#.#.#...#.....#...#...#.#.........#...#.#...#.#.#.#.#...#.#...#.....#.....#...#.#...#.#...#.#...#...#.#.#...#...#...............#.#...#.#
#.###.#.###.#.#########.###.#####.#.#.#.#.#.###.###.#.#.#.###.#.###########.#####.#.#####.#.###.#.#.###.#.#.###.###.#.###.#.#####.#.#.#######
#...#.#.#...#.....#...#.#...#.....#.#.#.#.....#.....#...#...................#...#.#.#...#.#.....#.#...#...#.....#.#.#...#.#.....#.#.#.......#
#.#.###.#.#.#####.#.#.#.#.###.#####.#.#.#####.#.#######.#####.#######.#######.#.#.#.#.#.#.#######.###.#####.#.###.#.#####.#####.#.#########.#
#.#...#...#...#.#...#...#...#.#.....#.#...#...#.#.....#.#.......#...#.#...#...#.#.#.#.#.#...#.....#.......#.#...#.....#...#.....#.#.........#
#.###.#######.#.#######.#.#.#.#.#####.###.#.###.#.###.#.#.#####.#.#.###.#.#.###.#.#.#.#.###.#.#####.#####.#.#.#.#####.#.###.#####.#.#########
#.#...#...#.......#...#.#.#.#.......#.......#.....#...#...#...#...#...#.#.#...#...#...#.#...#.#...#...#...#.#.#...#.....#.#.........#.......#
###.###.#.#.#######.#.#.###.#######.#####.#.#.#####.#######.#.#######.#.#.###.#######.#.#.###.#.#####.#.###.#####.#.###.#.#.#.###.#####.###.#
#...#...#...#.......#...#...#.....#.......#.#.....#.........#.#...#...#.#.#...#.....#...#.....#.#.....#...#.#.....#.......#.#.........#.#...#
#.###.#######.###########.#.#.###.#########.#.#####.#.###.###.#.#.#.###.#.#.#.#.###.#.#########.#.#########.#.#####.#####.#.#.###.###.###.#.#
#.....#.......#...........#.#...#...........#.#.......#...#...#.#.#...#.#.#.#.#...#.#.#.........#...#.......#.....#.#.......#...#.#.#.....#.#
#.#####.###.#####.#####.#######.#############.#.#######.#.###.#.#####.#.#.#.#####.#.#.#.#######.###.#.#######.###.#.###.###.#.###.#.#######.#
#.....#...#.#...#...#.#...#.....#.............#.........#...#...#...#.#.#...#.....#.#.#.#.....#.#.........#...#...#...#.#...#.#...#.....#...#
#####.###.###.#.###.#.###.#.#####.#####.#.#.###############.#.###.#.#.#.#####.#####.#.#.#.#####.#.#######.###.#.#####.#.#.###.#.#.#####.#.###
#...#...#.....#.#.#.#.#...#...........#.#.#.............#...#.#...#...#.....#.....#.#...#.#...#.#...#...#...#.#.#.....#.#.#...#...#.....#...#
###.###.#######.#.#.#.#.#####.#######.#.#.#.###########.#.#####.#######.###.#####.#.#####.#.#.#.###.#.#.###.###.###.###.#.#.#####.#.#######.#
#.....#.....#...#.#.#.#...#...........#.#.#.#.....#...#...#.....#...#.#.#.#.......#...#.#...#.....#...#...#...#...#...#.#.#.#...#.#.#.......#
#.#######.#.#.###.#.#.###.#.#.###.#######.###.###.###.###.#.#####.#.#.#.#.###.#######.#.#.#############.#.###.#.#.#.#.###.#.#.###.#.#.#######
#.........#.#.#.......#.#...#...#.......#.#...#...#...#...#.......#.#.........#.....#.#...#...#.........#...#...#.#.#.....#...#.............#
#.#########.#.#######.#.#######.#######.#.#.###.###.###.###########.#########.#.#.###.#.###.#.#.#####.#.#.#.###.#.#####.###.###.#.#.#######.#
#.....#.....#.#...#...#.......#.#.....#.#...#...#...#...#.....#...#.....#...#.#.#.#...#.....#...#...#.#.#.#.#.#.#.....#...#.#...#.#.#.......#
#####.#.###.#.#.#.#.###.#####.#.#.###.#.#.###.###.#.#.###.#.#.###.###.#.#.###.#.###.###.#########.###.###.#.#.#.#####.###.###.###.#.#.#.###.#
#...#...........#.#.#...#.....#.#.#.#...#...#.#...#...#...#.#.....#.#.........#.#...#...#...#.....#.......#...#.#.....#.......#...#.........#
#.#.#####.#.#####.#.###.#.#####.#.#.#######.#.#######.#####.#####.#.#.###.#####.#.#.#.#.#.#.#.###.#.#######.###.#.#.#############.#.###.###.#
#.........#.#...#.#.#...#.#...#...#.......#.#...#...#.........#.....#.#...#.....#.#...#.#.#...#.....#.....#.#...#.#.#.....#.......#...#...#.#
#.#####.###.#.###.#.#.###.#.#.#.#####.###.#.###.#.#.#########.#.#.###.#.###.#####.#.#####.###.#.#.#.#.###.###.###.###.###.#####.#####.#.#.###
#...............#.#...#...#...#.......#...#...#...#...#.......#.#.....#.#...#.....#.#.......#.#.#.#.#.#.....#...#.....#.#.#...#.......#.#...#
#.#.#.###.###.#.#.#########.#.#########.#####.#######.#######.#.#.#####.#.#.#.#####.#.#######.#.###.#.#.###.###.###.###.#.#.#.#####.#######.#
#.#.#...#.#...#.#.#.......#.#.........#...#.......#.#.......#.#.#.#...#...#.#.#.....#.#.......#.....#.#...#...#...#.....#...#.....#.#.....#.#
#.#.#####.#.###.#.#.#####.#.#########.###.#.#####.#.#######.#.#.#.#.#.#.#####.#.#####.#.#######.#####.###.#.#####.#####.#########.#.#.###.#.#
#.#.#...........#...#...#...#.......#.#.#.#.#...#...#...#...#.......#...#...#.#.......#.#...#.....#.............#...#...#.........#...#.#.#.#
#.#.#.#.#.#####.#####.#######.#.#####.#.#.###.#.###.#.#.#.###.#######.#.#.#.#.#.#######.#.#.#######.#########.#####.#####.#############.#.#.#
#.#...#.#.#.......#...#.......#.#.......#.#...#.#.....#.#.#.#.#...#...#.....#.#.#.....#...#...#.....#...#...#.....#.#.....#.........#...#.#.#
#.###.#.#.#.#####.###.#.###.#.###.#####.#.#.###.#########.#.#.###.#.###.###.#.#.#.#####.#####.#.#####.#.#.#.#####.#.#.#####.#.#######.#.#.#.#
#.....#.#.#...#...#...#...#.#.#...#.........#.......#.....#.#.....#...#.#.#...#...#.........#.#.#...#.#...#...#...#.#.#...............#.....#
#.###.#.#.#.#.#.#.#.#####.#.###.###.###############.#.#####.###.#####.#.#.#######.#.#######.#.#.#.###.#######.#.#.#.#.#.#####.#########.###.#
#.....#...#.#...#.#.....#...#...#.....#...........#...#.......#.#.....#.#.......#.#.#...#.....#.#.#...#.......#.#.#...#.#...#.#...#.......#.#
#.###.#########.#.###.#.#.#.#.#.#######.#########.#.#######.###.#.#####.###.#####.#.#.#.#.#####.#.#.#####.#####.###.###.#.#.#.#.###.###.###.#
#.#.............#...#.#...#...........#.#.#.....#.#.#...#...#...#.......#...#.....#...#.#.#...#...#.....#...#.....#.....#.#.#...#...#...#...#
#.###.#.###.#######.#.#####.###.#####.#.#.#.###.#.###.#.#.###.###########.###.#########.###.#.#.#.#####.###.#####.#.#####.#.#####.#######.###
#...........#.......#.#.....#.#.....#...#.#...#.#.....#.#.....#...#.....#.....#.......#.#...#...#.....#.#.........#.#...#.#.....#.#.......#.#
#.###.#####.###.#.#.###.###.#.#.###.#####.#.###.#.#####.#.#####.#.#.###.#.#########.#.#.#.#########.###.#.#######.#.###.#.#####.#.#.#######.#
#.#...#.....#...#.#.....#...#.#.#.......#...#...#.....#.#.....#.#...#...#.#.......#.#.#.........#...#...#.#.....#.#.....#...#.....#.#.......#
#.#.#.#.#####.###.#######.###.#.#.###.###.###.#.#.#####.#####.#.#######.#.#.#.###.#.#.#########.#.#.#.#.###.###.#.#####.###.#.###.#.#.#.#####
#.#.....#.....#...#.......................................................#.#.#...#.#...#...#.....#.#.#.....#...#.#...#...............#.#...#
#.###.###.#####.###.#.###.#######.###.#.#.###.###.#.#####.#.#####.#########.#.###.#.###.#.#.###.#.###.#.#####.#####.#.###.###.#.###.#.###.#.#
#.........#.#.....#...#...#.....#.#...#...#...#...#...#...#...#...#.......#.#...#...#...#.....................#...............#.....#.....#.#
###.#######.#.###.#.#.#.###.###.#.#.#.#.###.#.#.#.#.#.#.#####.#.#######.#.###.#.#########.###.#.###.###.#.#####.#.#.#.###.#.#.###########.#.#
#...#.......................#.#.#.#.#.....#.............................#...#.#.......#...#.........#...#.#.....#...#...#...#...#.......#.#.#
#.#####.#######.#.###.#######.#.###.#.#.#.#.###.#.###.#####.#.###.#########.#####.###.#.###.###.###.#.#.#.#.###########.#####.#.#.#.###.###.#
#...........#...#...#.........#.....#...#.#.#...#.....#...#.#.......#.......#...#.#...#.#.......................#.....#...#...#.#.#.#.#.#...#
#.#.#.#.#.#.#.#####.###.#############.#.#.#.#.#####.###.#.#.#####.#.#.#######.#.###.#.#.#######.#.#####.#.#####.#.###.#.#.#.#.#.#.#.#.#.#.#.#
#.#.#.#...#...#...#.......................#.#...#...#...#.#.#.......#.........#.....#.#.....#...#.......#...#...#.....#.....#...#.#.#.#.#.#.#
#.#.#.#########.#.#.#.###.#.###.#####.#.#.#.###.#####.###.#.#.###.###################.#####.#.#.###########.#.#######.#.#####.#####.#.#.#.#.#
#S..#...........#.......#.....#...............#.........#...#.............................#...............#...........#.............#.....#.#
#############################################################################################################################################"""

import enum
from dataclasses import dataclass
import heapq

MAX_INT = 10000000000000000

@dataclass(frozen=True)
class Position:
    r: int
    c: int

    # Comparison function needed since this is included in the priority queue.
    def __lt__(self, other):
        return self.r < other.r

class Direction(enum.Enum):
    RIGHT = 0
    DOWN = 1
    LEFT = 2
    UP = 3

    # Comparison function needed since this is included in the priority queue.
    def __lt__(self, other):
        return self.value < other.value

    def rotatedRight(self):
        directions = [Direction.RIGHT, Direction.DOWN, Direction.LEFT, Direction.UP]
        idx = directions.index(self)
        return directions[(idx + 1) % 4]
    
    def rotatedLeft(self):
        directions = [Direction.RIGHT, Direction.DOWN, Direction.LEFT, Direction.UP]
        idx = directions.index(self)
        return directions[(idx - 1) % 4]
    
    # Returns (rDelta, cDelta) to add to the current
    # position to move 1 position in this direction.
    def movement(self) -> tuple[int, int]:
        if self == Direction.RIGHT:
            return (0, 1)
        elif self == Direction.DOWN:
            return (1, 0)
        elif self == Direction.LEFT:
            return (0, -1)
        else:  # UP
            return (-1, 0)

class Room:
    initialPos: Position
    targetPos: Position
    initialDir: Direction
    matrix: list[list[str]]

    # Set of positions that belong to at least one min path.
    minPathPositions: set[Position]

    def __init__(self, input: str):
        self.matrix = [list(line) for line in input.split("\n")]
        for r in range(len(self.matrix)):
            for c in range(len(self.matrix[0])):
                if self.matrix[r][c] == 'S':
                    self.initialPos = Position(r, c)
                elif self.matrix[r][c] == 'E':
                    self.targetPos = Position(r, c)
        self.initialDir = Direction.RIGHT
        self.minPathPositions = set()

    # Given a starting score, position, and direction, tries to reach the end with a
    # score of 83444 (determined to be the minimum possible score in part 1).
    # If a path cannot be reached within that score, returns MAX_INT.
    # If a path can be reached, adds all positions in this path to self.minPathPositions.
    def minPathDfs(self,
                   score: int,
                   pos: Position,
                   dir: Direction,
                   # (position, direction)s in the current path
                   visiting: set[tuple[Position, Direction]],
                   # (position, direction)s mapped to minimum accumulated score to this point.
                   visited: dict[set[tuple[Position, Direction]], int]) -> int:
        if (pos.r < 0 or pos.r == len(self.matrix) or pos.c < 0 or pos.c == len(self.matrix[0])
            or self.matrix[pos.r][pos.c] == '#'
            or (pos, dir) in visiting
            or (pos, dir) in visited and score > visited[(pos, dir)]  # we've been here before, but with a smaller accumulated score.
            or score > 83444):
            return MAX_INT
        if pos == self.targetPos:
            print("found a path!")
            self.minPathPositions.update([pos for pos, _ in visiting])
            self.minPathPositions.add(self.targetPos)
            return score
        visiting.add((pos, dir))
        visited[(pos, dir)] = min(score, visited.get((pos, dir), MAX_INT))
        straightScore = self.minPathDfs(score + 1, Position(pos.r + dir.movement()[0], pos.c + dir.movement()[1]), dir, visiting, visited)
        scoreLeft = self.minPathDfs(score + 1000, pos, dir.rotatedLeft(), visiting, visited)
        scoreRight = self.minPathDfs(score + 1000, pos, dir.rotatedRight(), visiting, visited)
        visiting.remove((pos, dir))
        return min([straightScore, scoreLeft, scoreRight])

    def getNumberMinPaths(self):
        self.minPathDfs(0, room.initialPos, room.initialDir, set(), dict())
        return len(self.path) 

### Run program ###
# Note: In my environment, this takes ~5-10 minutes to complete.
room = Room(input)
print(room.getNumberMinPaths())